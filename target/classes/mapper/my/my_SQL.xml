<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="my">


	<!-- 마이페이지 내의 주문 / 배송 상태LIST -->
	<select id="my_order_list" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			select l.member_no, l.order_date, l.order_no, l.order_state, g.goods_name,
		        l.order_total_pay_price, l.order_pay_option, l.order_express,
      
		        (select count(SD.order_no) from order_detail SD where SD.order_no = D.order_no ) as hap_cnt
		
			from order_list l, order_detail d, goods g
				
			where l.order_no = d.order_no
				and d.goods_no = g.goods_no
				and l.member_no = #{member_no}
				and D.ORDER_DETAIL_NO in (select min(ORDER_DETAIL_NO) as Dno from order_detail group by order_no)
				
			order by l.order_date desc
		]]>
	</select>
	
	<select id="my_order_ok" parameterType="hashmap" > <!-- 주문상태 변경 -->
		<![CDATA[
			UPDATE order_list

			SET	order_state = order_state + 1
			
			WHERE order_no = ${order_no}
		]]>
	</select>
	
	
	
		
	<!-- 로그인 한 회원의 상품 주문 일자, 총 주문 금액, 주문상태 출력 -->
	<select id="selectOrderList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT 
				ORDER_DATE,
				ORDER_TOTAL_ORDER_PRICE,
				ORDER_STATE 
			FROM 
				ORDER_LIST 
			WHERE 
				MEMBER_NO = #{MEMBER_NO}
		]]>
	</select>
	
	<!-- 로그인 한 회원의 구매한 상품명, 상품속성 번호 출력 -->
	<select id="selectOrderList2" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT 
				g.GOODS_NAME,
				o.GOODS_ATT_NO,
				m.MEMBER_NO 
			FROM 
				GOODS g,
				ORDER_DETAIL o,
				MEMBER m 
			WHERE 
				g.GOODS_NO = o.GOODS_NO 
			AND 
				MEMBER_NO = #{MEMBER_NO}
		]]>
	</select>
	
	<!-- 로그인 한 회원의 정보 출력 (마이페이지 회원정보 수정) -->
	<select id="memberModify" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT 
				MEMBER_NO,
				MEMBER_ID,
				MEMBER_NAME,
				MEMBER_PASSWD,
				TO_CHAR(MEMBER_BIRTH,'YYYY/MM/DD') MEMBER_BIRTH,
				MEMBER_EMAIL,
				MEMBER_PHONE,
				MEMBER_ZIPCODE,
				MEMBER_ADDR1,
				MEMBER_ADDR2 
			FROM 
				MEMBER 
			WHERE 
				MEMBER_NO = #{MEMBER_NO}
		]]>
	</select>
	
	
	<!-- 회원 정보 수정 처리 -->
	<update id="memberModifyAction" parameterType="hashmap">
	<![CDATA[
		UPDATE MEMBER SET
			MEMBER_PASSWD = #{MEMBER_PASSWD},
			MEMBER_EMAIL = #{MEMBER_EMAIL},
			MEMBER_PHONE = #{MEMBER_PHONE},
			MEMBER_ZIPCODE = #{MEMBER_ZIPCODE},
			MEMBER_ADDR1 = #{MEMBER_ADDR1},
			MEMBER_ADDR2 = #{MEMBER_ADDR2},
			MEMBER_BIRTH = #{MEMBER_BIRTH} 
		WHERE 
			MEMBER_NO = #{MEMBER_NO}
	]]>
	</update>
	
	<update id="memberDelete">
		UPDATE MEMBER SET 
			MEMBER_DELETE = '1' 
		WHERE 
			MEMBER_NO = #{MEMBER_NO}
	</update>

	
		
</mapper>